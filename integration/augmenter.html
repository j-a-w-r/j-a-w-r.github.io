<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2017-04-10 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170410" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Jawr - Integrating Jawr in a framework</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.1.min.js"></script>

              
                  </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/j-a-w-r/jawr-main-repo">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2></h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2017-04-10
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 3.9
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">About</li>
                              
      <li>
  
                          <a href="../index.html" title="Home">
          <i class="none"></i>
        Home</a>
            </li>
                
      <li>
  
                          <a href="../introduction.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                
      <li>
  
                          <a href="../features.html" title="Features">
          <i class="none"></i>
        Features</a>
            </li>
                
      <li>
  
                          <a href="../changes.html" title="Change history">
          <i class="none"></i>
        Change history</a>
            </li>
                
      <li>
  
                          <a href="../team.html" title="The team">
          <i class="none"></i>
        The team</a>
            </li>
                              <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="../docs/servlet.html" title="The Jawr servlet">
          <i class="none"></i>
        The Jawr servlet</a>
            </li>
                
      <li>
  
                          <a href="../docs/descriptor_syntax.html" title="Descriptor syntax">
          <i class="none"></i>
        Descriptor syntax</a>
            </li>
                
      <li>
  
                          <a href="../docs/custom_bundles.html" title="Bundle definition">
          <i class="none"></i>
        Bundle definition</a>
            </li>
                
      <li>
  
                          <a href="../docs/source_ordering.html" title="Source order in bundles">
          <i class="none"></i>
        Source order in bundles</a>
            </li>
                
      <li>
  
                          <a href="../docs/cacheManager.html" title="Cache manager">
          <i class="none"></i>
        Cache manager</a>
            </li>
                
      <li>
  
                          <a href="../docs/global_preprocessors.html" title="Global preprocessors">
          <i class="none"></i>
        Global preprocessors</a>
            </li>
                
      <li>
  
                          <a href="../docs/global_postprocessors.html" title="Global postprocessors">
          <i class="none"></i>
        Global postprocessors</a>
            </li>
                
      <li>
  
                          <a href="../docs/postprocessors.html" title="Postprocessors">
          <i class="none"></i>
        Postprocessors</a>
            </li>
                
      <li>
  
                          <a href="../docs/generators.html" title="Generators">
          <i class="none"></i>
        Generators</a>
            </li>
                
      <li>
  
                          <a href="../docs/advanced_generators.html" title="Advanced generators">
          <i class="none"></i>
        Advanced generators</a>
            </li>
                
      <li>
  
                          <a href="../docs/license_files.html" title="Licenses in resources">
          <i class="none"></i>
        Licenses in resources</a>
            </li>
                
      <li>
  
                          <a href="../docs/taglibs.html" title="JSP Tag library">
          <i class="none"></i>
        JSP Tag library</a>
            </li>
                
      <li>
  
                          <a href="../docs/plain_html.html" title="Use in HTML pages">
          <i class="none"></i>
        Use in HTML pages</a>
            </li>
                
      <li>
  
                          <a href="../docs/modes.html" title="Debug and production modes">
          <i class="none"></i>
        Debug and production modes</a>
            </li>
                
      <li>
  
                          <a href="../docs/messages_gen.html" title="i18n message generator">
          <i class="none"></i>
        i18n message generator</a>
            </li>
                
      <li>
  
                          <a href="../docs/variant_bundle.html" title="Variant bundles">
          <i class="none"></i>
        Variant bundles</a>
            </li>
                
      <li>
  
                          <a href="../docs/illegalBundleRequestHander.html" title="Jawr strict mode - Illegal bundle request handler">
          <i class="none"></i>
        Jawr strict mode - Illegal bundle request handler</a>
            </li>
                
      <li>
  
                          <a href="../docs/jmx_support.html" title="JMX Support">
          <i class="none"></i>
        JMX Support</a>
            </li>
                
      <li>
  
                          <a href="../docs/bundle_preprocessing.html" title="Bundle preprocessing">
          <i class="none"></i>
        Bundle preprocessing</a>
            </li>
                
      <li>
  
                          <a href="../docs/jawr_maven_plugin.html" title="Jawr Maven plugin">
          <i class="none"></i>
        Jawr Maven plugin</a>
            </li>
                
      <li>
  
                          <a href="../docs/jawr_ant_task.html" title="Jawr Ant task">
          <i class="none"></i>
        Jawr Ant task</a>
            </li>
                
      <li>
  
                          <a href="../migrationGuide.html" title="Migration Guide">
          <i class="none"></i>
        Migration Guide</a>
            </li>
                
      <li>
  
                          <a href="../migrationGitRepo.html" title="Github repository Migration Guide">
          <i class="none"></i>
        Github repository Migration Guide</a>
            </li>
                              <li class="nav-header">Integration</li>
                              
      <li class="active">
  
            <a href="#"><i class="none"></i>Add Jawr to your framework</a>
          </li>
                
      <li>
  
                          <a href="../integration/spring.html" title="Spring MVC">
          <i class="none"></i>
        Spring MVC</a>
            </li>
                
      <li>
  
                          <a href="../integration/facelets.html" title="Facelets Tag library">
          <i class="none"></i>
        Facelets Tag library</a>
            </li>
                
      <li>
  
                          <a href="../integration/wicket.html" title="Wicket">
          <i class="none"></i>
        Wicket</a>
            </li>
                
      <li>
  
                          <a href="../integration/grails.html" title="Grails plugin">
          <i class="none"></i>
        Grails plugin</a>
            </li>
                
      <li>
  
                          <a href="../integration/dwr.html" title="DWR">
          <i class="none"></i>
        DWR</a>
            </li>
                
      <li>
  
                          <a href="../integration/validator.html" title="Commons Validator - Struts">
          <i class="none"></i>
        Commons Validator - Struts</a>
            </li>
                              <li class="nav-header">Tutorials</li>
                              
      <li>
  
                          <a href="../tutorials/quickstart.html" title="Quick start">
          <i class="none"></i>
        Quick start</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/howToUseJawrSmartbundling.html" title="How to use Jawr smart bundling feature">
          <i class="none"></i>
        How to use Jawr smart bundling feature</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/howToUseJawrToServeImage.html" title="How to use Jawr to serve image resources">
          <i class="none"></i>
        How to use Jawr to serve image resources</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/howToUseJawrCssSkin.html" title="How to use Jawr to generate CSS skin">
          <i class="none"></i>
        How to use Jawr to generate CSS skin</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/jawrSpriteImage.html" title="How to generate Image sprites with Jawr">
          <i class="none"></i>
        How to generate Image sprites with Jawr</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/howToUseJawrToGenerateBase64Image.html" title="How to generate base64 images in CSS with Jawr">
          <i class="none"></i>
        How to generate base64 images in CSS with Jawr</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/howToUseGoogleClosureCompiler.html" title="How to use Google Closure Compiler with Jawr">
          <i class="none"></i>
        How to use Google Closure Compiler with Jawr</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/howToSetJsEngine.html" title="How to set Javascript engine in Jawr">
          <i class="none"></i>
        How to set Javascript engine in Jawr</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/howToEnablePerformanceLogging.html" title="How to set performance logging in Jawr">
          <i class="none"></i>
        How to set performance logging in Jawr</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/faq_howto.html" title="FAQ-Howto">
          <i class="none"></i>
        FAQ-Howto</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/libraries.html" title="Using popular libraries">
          <i class="none"></i>
        Using popular libraries</a>
            </li>
                
      <li>
  
                          <a href="../docs/sampleApplications.html" title="Sample applications">
          <i class="none"></i>
        Sample applications</a>
            </li>
                              <li class="nav-header">API and sources</li>
                              
      <li>
  
                          <a href="../nonav/apidocs/index.html" title="JavaDocs">
          <i class="none"></i>
        JavaDocs</a>
            </li>
                
      <li>
  
                          <a href="../nonav/xref/index.html" title="Source XREF">
          <i class="none"></i>
        Source XREF</a>
            </li>
                              <li class="nav-header">Github repositories</li>
                              
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-main-repo" class="externalLink" title="Jawr main repository">
          <i class="none"></i>
        Jawr main repository</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-core" class="externalLink" title="Jawr core repository">
          <i class="none"></i>
        Jawr core repository</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-spring" class="externalLink" title="Jawr spring repository">
          <i class="none"></i>
        Jawr spring repository</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-wicket" class="externalLink" title="Jawr wicket repository">
          <i class="none"></i>
        Jawr wicket repository</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-grails" class="externalLink" title="Jawr grails repository">
          <i class="none"></i>
        Jawr grails repository</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-dwr2.x" class="externalLink" title="Jawr dwr2.x repository">
          <i class="none"></i>
        Jawr dwr2.x repository</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-dwr3.x" class="externalLink" title="Jawr dwr3.x repository">
          <i class="none"></i>
        Jawr dwr3.x repository</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-tools" class="externalLink" title="Jawr tools repository">
          <i class="none"></i>
        Jawr tools repository</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section">
<h2>Integrating Jawr in a framework<a name="Integrating_Jawr_in_a_framework"></a></h2>
<p>Jawr lends itself to integrating in web frameworks of wider scope. If you have one and want to use Jawr, you probably will want your users to benefit from it instead of just using it for your framework&#x2019;s needs.</p>
<p>This means that you will probably use Jawr to bundle scripts and CSS to enhance performance. But your framework&#x2019;s users will probably benefit from using Jawr to bundle and compress their resources with Jawr. Better yet, they could augment the bundles that come with your framework for the tightest integration and lowest response times for pages.</p>
<p>In order to achieve this, Jawr has some hooks to provide multiple configuration files that augment each other. The idea behind this is that you will provide with a base configuration, which defines several standard bundles. Then you provide configuration hooks to add additional config files, in which users define their own bundles and also augment those in your framework.</p>
<p>Two components help in achieving this functionality: <b>ConfigPropertiesAugmenter</b> and <b>MultipleFileConfigSource</b>. The latter is a pre-cooked implementation of the ConfigPropertiesSource interface which you can extend to easily get up and running with this configuration scheme. ConfigPropertiesAugmenter is a lower level component that you can use if extending MultipleFileConfigSource does not suit your needs.</p>
<p>In some cases, you might want to create your own system to render the links and script tags in HTML pages, instead of using the included tag libraries from Jawr. It is actually rather easy to accomplish this, if you follow the instructions at the bottom of this page.</p>
<div class="section">
<h3>Extending MultipleFileConfigSource<a name="Extending_MultipleFileConfigSource"></a></h3>
<p>This class loads a configuration file in the usual Jawr way (i.e., loads the config file specified in the configLocation init-param), and then loads further configuration files which augment the base configuration. By default, the additional configuration properties are defined as a parameter in the servlet context, under the key &#x2018;jawr.config.sources&#x2019;. In the web.xml, configuration would be defined as follows:</p>

<div class="source">
<pre>        &lt;context-param&gt;
                &lt;param-name&gt;jawr.config.sources&lt;/param-name&gt;
                &lt;param-value&gt;file:C:\jawr_A.properties,file:C:\jawr_B.properties&lt;/param-value&gt;
        &lt;/context-param&gt;
</pre></div>
<p>Of course, this is not the best way to achieve this ends. You framework will probably have better ways to configure this parameter, so all you need to do is to extend MultipleFileConfigSource and to override the method that retrieves the parameter value, which has the following signature:</p>

<div class="source">
<pre>        protected void initAdditionalPropertyBaseNames(ServletContext context); 
</pre></div>
<p>This method should initialize a property named &#x2018;propertyBaseNames&#x2019; (which is a List object), and add to it the names of the properties files which should override the base configuration. Optionally, you can also initialize another object, this time a Set, named &#x2018;privateConfigProperties&#x2019;, and add all the names of properties that you don&#x2019;t wish to let users change or augment.</p>
<p>Once this is done, you only need to register your object as the ConfigPropertiesSource for Jawr, so it will be used instead of the default one. Normally it is done through the servlet configuration:</p>

<div class="source">
<pre>                &lt;init-param&gt;
                        &lt;param-name&gt;configPropertiesSourceClass&lt;/param-name&gt;
                        &lt;param-value&gt;org.myframework.MyConfigPropertiesImplementation&lt;/param-value&gt;
                &lt;/init-param&gt;
</pre></div>
<p>The benefit of overriding MultipleFileConfigSource is that the automatic reloading of configuration will work out of the box. Users will be able to set the time interval to check for changes in the configuration and have Jawr reload whenever changes are made. Also, the syntax to specify the location of config files remains the same as usual (using &#x2018;file:&#x2019; as a prefix to load from the filesystem, or no prefix to load from the classpath).</p></div>
<div class="section">
<h3>Using ConfigPropertiesAugmenter<a name="Using_ConfigPropertiesAugmenter"></a></h3>
<p>Normally, you will not need to use this class directly (being much better to override MultipleFileConfigSource), but it&#x2019;s important to know its behavior to understand how config augmentation works. So, read on even if you don&#x2019;t plan on using it. This class has two constructors:</p>

<div class="source">
<pre>public ConfigPropertiesAugmenter(Properties configProperties);
public ConfigPropertiesAugmenter(Properties configProperties,Set privateConfigProperties);
</pre></div>
<p>Both get the base Properties to later augment, and in the second case, a Set of &#x2018;private&#x2019; config properties. This set contains names of configuration properties which will not be overwritten or augmented. For instance, if you do not wish to allow users to change the encoding of bundles (which is probably a good idea), you would add &#x2018;jawr.charset.name&#x2019; to this Set.</p>
<p>The method which augments configuration is this one:</p>

<div class="source">
<pre>         public void augmentConfiguration(Properties configToAdd); 
</pre></div>
<p>This method will get all properties in configToAdd and overwrite those in the base configuration, <i>except</i> for those which are augmentable. Augmentable properties will be <i>extended</i>. Take for instance a mapping property such as this:</p>

<div class="source">
<pre>         jawr.js.bundle.one.mappings=/js/someFile.js, /js/someOtherFile.js
</pre></div>
<p>Now, in an additional Properties file we have this mapping:</p>

<div class="source">
<pre>         jawr.js.bundle.one.mappings=/javascript/userProvidedScript.js
</pre></div>
<p>Well, after augmentation, the final configuration would look like this:</p>

<div class="source">
<pre>         jawr.js.bundle.one.mappings=/js/someFile.js, /js/someOtherFile.js, /javascript/userProvidedScript.js
</pre></div>
<p>In this example the user augments the mappings of a framework-provided bundle with his own content, thus reducing the total number of required downloads to access his application.</p>
<p>The augmentable properties are the following:</p>

<ul>
  
<li>Bundle definitions (jawr.[type].bundle.names). Note this property is deprecated as of version 2.7, but you can&#x2019;t mix configurations with and without it, so be sure to make it clear whether it should be used or not when letting others augment your configuration.</li>
  
<li>Bundle mappings (jawr.[type].bundle.[name].mappings).</li>
  
<li>Composite bundles child members (jawr.[type].bundle.[name].child.names).</li>
  
<li>Custom postprocessors (jawr.custom.postprocessors.names).</li>
  
<li>Generators (jawr.custom.generators).</li>
</ul>
<p>All the other properties will simply be overwritten.</p></div>
<div class="section">
<h3>Documenting your configuration<a name="Documenting_your_configuration"></a></h3>
<p>Once you have Jawr setup this way, the best thing you can do is to document how to use Jawr, and to specify which bundles you are using and how to augment them, in order to get the most out of Jawr usage.</p></div>
<div class="section">
<h3>Replicating the tag library behavior<a name="Replicating_the_tag_library_behavior"></a></h3>
<p>If your framework has anything other than JSP or JSF as the HTML rendering system, then you won&#x2019;t be able to use the tag libraries that Jawr provides. Luckily, it is quite easy to replicate the behavior using the same API used by the taglib. The only functional requirement is to have access to an HttpServletRequest instance and to the current ServletContext when generating the output. If you have a request and access to the ServletContext, Jawr will be able to generate the HTML for you.</p>
<p>Note that you can get the ServletContext using request.getSession().getServletContext(), but this may not always be desirable since it grants the request a session id.</p>
<p>So, if you are ready to get your hands dirty, first be sure you know how the tag libraries work and the parameters they receive so you understand the APIs described below. The component which generates the output is an instance of the BundleRenderer interface; Jawr provides two implementations of this interface. Obviously there&#x2019;s one to render script tags and another to render CSS link tags. The renderers are:</p>

<div class="source">
<pre>net.jawr.web.resource.bundle.renderer.JavascriptHTMLBundleLinkRenderer
net.jawr.web.resource.bundle.renderer.CSSHTMLBundleLinkRenderer
</pre></div>
<p>The constructor of both classes requires an instance of a ResourceBundlesHandler component, which you will get from the ServletContext instance using one of two keys, each belonging to a resource type:</p>

<div class="source">
<pre>ResourceBundlesHandler rsHandler = (ResourceBundlesHandler) 
        servletContext.getAttribute(ResourceBundlesHandler.JS_CONTEXT_ATTRIBUTE);
</pre></div>
<p>or:</p>

<div class="source">
<pre>ResourceBundlesHandler rsHandler = (ResourceBundlesHandler) 
        servletContext.getAttribute(ResourceBundlesHandler.CSS_CONTEXT_ATTRIBUTE);
</pre></div>
<p>These ResourceBundlesHandler are created by Jawr during the server startup procedure and set as context attributes using the string keys shown above. If any of these are null, it means that something went wrong while Jawr was initializing. Once you have this reference, it is easy to create an instance of the renderers:</p>

<div class="source">
<pre>BundleRenderer myJsRenderer = new JavascriptHTMLBundleLinkRenderer(rsHandler, true); 
BundleRenderer myCSSRenderer = new CSSHTMLBundleLinkRenderer(rsHandler, true, &quot;screen&quot;);
</pre></div>
<p>As you noticed, the constructors receive additional parameters: a boolean and, in the case of the CSS renderer, a String. The boolean corresponds to the tag library parameter &#x2018;useRandomParam&#x2019;, and the string (which may be null) is the &#x2018;media&#x2019; param for the CSS tag. Refer to the taglib docs for further explanation of what these do.</p>
<p>Once you have a proper instance of BundleRenderer, there is just one method to invoke, so the only thing left to do is to gather the required parameters and make the call. Let&#x2019;s review the API:</p>

<div class="source">
<pre>public void renderBundleLinks(  String requestedPath, 
                                BundleRendererContext bundleRendererCtx,
                                Writer out ) throws IOException;
</pre></div>
<p>The parameters represent the following data:</p>

<ul>
  
<li><b>requestedPath</b> corresponds to the taglib&#x2019;s <b>src</b> attribute, so it may be a bundle id or the path to a bundle member.</li>
  
<li>
<p><b>bundleRendererCtx</b> the context of the renderer. To obtain a BundleRendererContext, you could use the following utility method :</p>
  
<div class="source">
<pre>BundleRendererContext ctx = RendererRequestUtils.getBundleRendererContext(request, renderer);
</pre></div></li>
</ul>
<p>This object contains :</p>

<ul>
  
<li><b>contextPath</b> is obviously the request context path, as  retrieved from request.getContextPath().</li>
  
<li>
<p><b>variantKey</b> is used for the i18n scripts. To retrieve this  you need to perform a somewhat long call using the  ResourceBundlesHandler instance you retrieved from the servlet  context:</p>
  
<div class="source">
<pre>    String variantKey = rsHandler.getConfig().getLocaleResolver().resolveLocaleCode(request);
</pre></div></li>
</ul>

<ul>
  
<li>
<p><b>includedBundles</b> is a Set which holds a log of written tags  during the request so that no tag is written out twice. You  don&#x2019;t actually need to handle its creation or to hold  a reference. Instead rely on a utility method that handles  everything:</p>
  
<div class="source">
<pre>    Set includedBundles = RendererRequestUtils.getAddedBundlesLog(request);
</pre></div></li>
</ul>

<ul>
  
<li>
<p><b>useGzip</b> determines whether to use the gzip compressed version  of the scripts, based on Jawr configuration and on the  request headers. Again, a utility method will take care  of everything. You will need to reuse the ResourceBundlesHandler  instance once more for this one:</p>
  
<div class="source">
<pre>    boolean useGzip = RendererRequestUtils.isRequestGzippable(request,rsHandler.getConfig());
</pre></div></li>
  
<li>
<p><b>out</b> is a Writer instance into which the tags will be written. If you just need a string it is perfectly okay to use a StringWriter instance for this purpose. Note that Jawr will not flush nor close this Writer.</p></li>
</ul>
<p>And this basically covers it. If you want a sample, check out the <b>net.jawr.web.taglib</b> package sources (Jawr sources are available for download and also the SVN is publicly accessible). In this package are all the current implementations of tag libraries used by Jawr, so you can probably get ideas from there.</p></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                   2017.
          All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
