<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2017-04-10 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170410" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Jawr - Bundle preprocessing</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.1.min.js"></script>

              
                  </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/j-a-w-r/jawr-main-repo">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2></h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2017-04-10
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 3.9
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">About</li>
                              
      <li>
  
                          <a href="../index.html" title="Home">
          <i class="none"></i>
        Home</a>
            </li>
                
      <li>
  
                          <a href="../introduction.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                
      <li>
  
                          <a href="../features.html" title="Features">
          <i class="none"></i>
        Features</a>
            </li>
                
      <li>
  
                          <a href="../changes.html" title="Change history">
          <i class="none"></i>
        Change history</a>
            </li>
                
      <li>
  
                          <a href="../team.html" title="The team">
          <i class="none"></i>
        The team</a>
            </li>
                              <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="../docs/servlet.html" title="The Jawr servlet">
          <i class="none"></i>
        The Jawr servlet</a>
            </li>
                
      <li>
  
                          <a href="../docs/descriptor_syntax.html" title="Descriptor syntax">
          <i class="none"></i>
        Descriptor syntax</a>
            </li>
                
      <li>
  
                          <a href="../docs/custom_bundles.html" title="Bundle definition">
          <i class="none"></i>
        Bundle definition</a>
            </li>
                
      <li>
  
                          <a href="../docs/source_ordering.html" title="Source order in bundles">
          <i class="none"></i>
        Source order in bundles</a>
            </li>
                
      <li>
  
                          <a href="../docs/cacheManager.html" title="Cache manager">
          <i class="none"></i>
        Cache manager</a>
            </li>
                
      <li>
  
                          <a href="../docs/global_preprocessors.html" title="Global preprocessors">
          <i class="none"></i>
        Global preprocessors</a>
            </li>
                
      <li>
  
                          <a href="../docs/global_postprocessors.html" title="Global postprocessors">
          <i class="none"></i>
        Global postprocessors</a>
            </li>
                
      <li>
  
                          <a href="../docs/postprocessors.html" title="Postprocessors">
          <i class="none"></i>
        Postprocessors</a>
            </li>
                
      <li>
  
                          <a href="../docs/generators.html" title="Generators">
          <i class="none"></i>
        Generators</a>
            </li>
                
      <li>
  
                          <a href="../docs/advanced_generators.html" title="Advanced generators">
          <i class="none"></i>
        Advanced generators</a>
            </li>
                
      <li>
  
                          <a href="../docs/license_files.html" title="Licenses in resources">
          <i class="none"></i>
        Licenses in resources</a>
            </li>
                
      <li>
  
                          <a href="../docs/taglibs.html" title="JSP Tag library">
          <i class="none"></i>
        JSP Tag library</a>
            </li>
                
      <li>
  
                          <a href="../docs/plain_html.html" title="Use in HTML pages">
          <i class="none"></i>
        Use in HTML pages</a>
            </li>
                
      <li>
  
                          <a href="../docs/modes.html" title="Debug and production modes">
          <i class="none"></i>
        Debug and production modes</a>
            </li>
                
      <li>
  
                          <a href="../docs/messages_gen.html" title="i18n message generator">
          <i class="none"></i>
        i18n message generator</a>
            </li>
                
      <li>
  
                          <a href="../docs/variant_bundle.html" title="Variant bundles">
          <i class="none"></i>
        Variant bundles</a>
            </li>
                
      <li>
  
                          <a href="../docs/illegalBundleRequestHander.html" title="Jawr strict mode - Illegal bundle request handler">
          <i class="none"></i>
        Jawr strict mode - Illegal bundle request handler</a>
            </li>
                
      <li>
  
                          <a href="../docs/jmx_support.html" title="JMX Support">
          <i class="none"></i>
        JMX Support</a>
            </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>Bundle preprocessing</a>
          </li>
                
      <li>
  
                          <a href="../docs/jawr_maven_plugin.html" title="Jawr Maven plugin">
          <i class="none"></i>
        Jawr Maven plugin</a>
            </li>
                
      <li>
  
                          <a href="../docs/jawr_ant_task.html" title="Jawr Ant task">
          <i class="none"></i>
        Jawr Ant task</a>
            </li>
                
      <li>
  
                          <a href="../migrationGuide.html" title="Migration Guide">
          <i class="none"></i>
        Migration Guide</a>
            </li>
                
      <li>
  
                          <a href="../migrationGitRepo.html" title="Github repository Migration Guide">
          <i class="none"></i>
        Github repository Migration Guide</a>
            </li>
                              <li class="nav-header">Integration</li>
                              
      <li>
  
                          <a href="../integration/augmenter.html" title="Add Jawr to your framework">
          <i class="none"></i>
        Add Jawr to your framework</a>
            </li>
                
      <li>
  
                          <a href="../integration/spring.html" title="Spring MVC">
          <i class="none"></i>
        Spring MVC</a>
            </li>
                
      <li>
  
                          <a href="../integration/facelets.html" title="Facelets Tag library">
          <i class="none"></i>
        Facelets Tag library</a>
            </li>
                
      <li>
  
                          <a href="../integration/wicket.html" title="Wicket">
          <i class="none"></i>
        Wicket</a>
            </li>
                
      <li>
  
                          <a href="../integration/grails.html" title="Grails plugin">
          <i class="none"></i>
        Grails plugin</a>
            </li>
                
      <li>
  
                          <a href="../integration/dwr.html" title="DWR">
          <i class="none"></i>
        DWR</a>
            </li>
                
      <li>
  
                          <a href="../integration/validator.html" title="Commons Validator - Struts">
          <i class="none"></i>
        Commons Validator - Struts</a>
            </li>
                              <li class="nav-header">Tutorials</li>
                              
      <li>
  
                          <a href="../tutorials/quickstart.html" title="Quick start">
          <i class="none"></i>
        Quick start</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/howToUseJawrSmartbundling.html" title="How to use Jawr smart bundling feature">
          <i class="none"></i>
        How to use Jawr smart bundling feature</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/howToUseJawrToServeImage.html" title="How to use Jawr to serve image resources">
          <i class="none"></i>
        How to use Jawr to serve image resources</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/howToUseJawrCssSkin.html" title="How to use Jawr to generate CSS skin">
          <i class="none"></i>
        How to use Jawr to generate CSS skin</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/jawrSpriteImage.html" title="How to generate Image sprites with Jawr">
          <i class="none"></i>
        How to generate Image sprites with Jawr</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/howToUseJawrToGenerateBase64Image.html" title="How to generate base64 images in CSS with Jawr">
          <i class="none"></i>
        How to generate base64 images in CSS with Jawr</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/howToUseGoogleClosureCompiler.html" title="How to use Google Closure Compiler with Jawr">
          <i class="none"></i>
        How to use Google Closure Compiler with Jawr</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/howToSetJsEngine.html" title="How to set Javascript engine in Jawr">
          <i class="none"></i>
        How to set Javascript engine in Jawr</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/howToEnablePerformanceLogging.html" title="How to set performance logging in Jawr">
          <i class="none"></i>
        How to set performance logging in Jawr</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/faq_howto.html" title="FAQ-Howto">
          <i class="none"></i>
        FAQ-Howto</a>
            </li>
                
      <li>
  
                          <a href="../tutorials/libraries.html" title="Using popular libraries">
          <i class="none"></i>
        Using popular libraries</a>
            </li>
                
      <li>
  
                          <a href="../docs/sampleApplications.html" title="Sample applications">
          <i class="none"></i>
        Sample applications</a>
            </li>
                              <li class="nav-header">API and sources</li>
                              
      <li>
  
                          <a href="../nonav/apidocs/index.html" title="JavaDocs">
          <i class="none"></i>
        JavaDocs</a>
            </li>
                
      <li>
  
                          <a href="../nonav/xref/index.html" title="Source XREF">
          <i class="none"></i>
        Source XREF</a>
            </li>
                              <li class="nav-header">Github repositories</li>
                              
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-main-repo" class="externalLink" title="Jawr main repository">
          <i class="none"></i>
        Jawr main repository</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-core" class="externalLink" title="Jawr core repository">
          <i class="none"></i>
        Jawr core repository</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-spring" class="externalLink" title="Jawr spring repository">
          <i class="none"></i>
        Jawr spring repository</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-wicket" class="externalLink" title="Jawr wicket repository">
          <i class="none"></i>
        Jawr wicket repository</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-grails" class="externalLink" title="Jawr grails repository">
          <i class="none"></i>
        Jawr grails repository</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-dwr2.x" class="externalLink" title="Jawr dwr2.x repository">
          <i class="none"></i>
        Jawr dwr2.x repository</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-dwr3.x" class="externalLink" title="Jawr dwr3.x repository">
          <i class="none"></i>
        Jawr dwr3.x repository</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/j-a-w-r/jawr-tools" class="externalLink" title="Jawr tools repository">
          <i class="none"></i>
        Jawr tools repository</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section">
<h2>Bundle preprocessing<a name="Bundle_preprocessing"></a></h2>
<p>One of the key features of Jawr is its ability to bundle resources. The process of bundling involves the following steps:</p>

<ul>
  
<li>Resolve the bundle mapping definition</li>
  
<li>Aggregate resources</li>
  
<li>Minify them</li>
  
<li>Apply custom post processors</li>
  
<li>Generate GZIP and non GZIP version</li>
</ul>
<p>By default, this process is done at server startup. This bundling process could take some time, when the application contains a large number of bundles.</p>
<p>Since Jawr 3.0, we have added a feature to preprocess the Jawr bundles. The bundle preprocessing is almost the same as the standard processing, except that it could be done during a build.</p>
<p>We have added 2 properties:</p>

<ul>
  
<li><b>jawr.use.bundle.mapping</b> : This flag indicates if during the server startup we should use the data of the preprocessed bundles instead of performing the bundling process. The preprocessed bundles will be found in the Jawr working directory. (See below)</li>
  
<li><b>jawr.working.directory</b> : This property defines where the jawr working directory is. By default, it&#x2019;s jawrTmp in the web application working directory.</li>
</ul>
<div class="section">
<h3>Use bundle mapping property<a name="Use_bundle_mapping_property"></a></h3>
<p>When the property <b>jawr.use.bundle.mapping</b> is set to true, Jawr will try to use specific files, which contain all the data about the bundles (full mapping paths, bundle hash code &#x2026;). These files are searched in the working directory (jawrWrkDir/jawr-(js/css/img)-mapping.properties ). If these files are not found, Jawr will create them in the working directory.</p>
<p>So if you have this property set to true, and you start a fresh application with an empty working directory, the first time, Jawr will process the bundle normally and it will create the mapping files. Then the next time, when you restart your application, Jawr will use the mappings files and skip the bundling process, this will make the startup time of the web application faster.</p>
<p>Note: The full image mapping file located at jawrWrkDir/jawr-img-mapping.properties, will be generated from the image resources defined with the <i>jawr.image.resources</i> property and the CSS images used in the CSS bundles. So for an image which is referenced by an image tag, and which is not part of the image mapping, the hashcode will be generated at runtime, and put in cache.</p></div>
<div class="section">
<h3>Jawr working directory<a name="Jawr_working_directory"></a></h3>
<p>We have added the option to define explicitly the location of the working directory. By default the working directory is set in <b>webAppWrkDir</b>/jawrTmp/</p>
<p>The user could define the working directory location somewhere else on the file system using a value, which is prefixed by **<a class="externalLink" href="file://**">file://**</a>. For example:</p>

<div class="source">
<pre>        jawr.working.directory=file://D:/temp/jawr/
</pre></div>
<p>The user could also define the working directory inside the web application itself. In that case, the value should be a relative path from the web application root directory. For example:</p>

<div class="source">
<pre>        jawr.working.directory=/jawrContent/
</pre></div>
<p>But in that case, Jawr will not be able to create the temporary files in the web application. So this means that the user will have to create the temporary files, and put them in the web application.</p></div>
<div class="section">
<h3>Bundle Processor<a name="Bundle_Processor"></a></h3>
<p>This class is responsible for preprocessing the bundles, creating the Jawr working directory and the CDN directory.</p>
<p>In the working directory, you will have the content of Jawr working directory generated by Jawr.</p>
<p>In the CDN directory, you will have all the data for the CDN.</p>
<p>An Ant task and a maven plugin have been created to make it easy to integrate into the build process. For more information about the usage, please check the documentation for <a href="./jawr_maven_plugin.html">the maven plugin</a> and <a href="./jawr_ant_task.html">the Ant task</a>.</p>
<p>To implement this feature, we have decided to simulate the server startup.</p>
<p>This means that we are faking the application server startup:</p>

<ul>
  
<li>We read the web.xml file</li>
  
<li>We initialize the servlets</li>
  
<li>Then we launch the bundling process.</li>
</ul>
<p>The main method of the bundle processor is the <b>process</b> method. This method takes 5 parameters:</p>

<ul>
  
<li><b>baseDirPath</b> the web application base directory path</li>
  
<li><b>tmpDirPath</b> the temporary directory path</li>
  
<li><b>destDirPath</b> the destination directory path, where the result will be stored</li>
  
<li><b>springConfigFiles</b> the comma separated list of spring configuration files, which will be used to initialize the Jawr spring controller. This property accepts any spring resource location definition like classpath:&#x2026;, file:&#x2026;, etc</li>
  
<li><b>servletsToInitialize</b> the list of comma separated names of servlets to initialize</li>
  
<li><b>generateCdnFiles</b> the flag indicating if we should generate the CDN files or not</li>
  
<li><b>keepUrlMapping</b> The flag indicating if we want to keep the jawr URL mapping or if we rewrite it to remove resource hashcode.</li>
</ul>
<div class="section">
<h4>Limitations<a name="Limitations"></a></h4>
<p>As we have seen, the bundle preprocessing has almost the same behaviour as the standard bundle processing. To implement this feature, we have decided to simulate the server startup. By default we will only initialize the Jawr servlets. You could add in the <b>servletsToInitialize</b> the list of servlets to initialize.</p>
<p>As said above, we only fake a server startup, which means that we don&#x2019;t initialize the entire web application context (filters, servlets &#x2026;). This could be a problem if you are initializing things, in the standard server startup, which are used later in Jawr. These elements could be missing. This is why we have added the parameter <b>servletsToInitialize</b> to be able to initialize other servlets, which you could initialize data used later by Jawr.</p></div></div>
<div class="section">
<h3>Spring MVC support<a name="Spring_MVC_support"></a></h3>
<p>As the bundle processor simulates the server startup, the idea is to only initialize the Jawr component. So with the <b>springConfigFiles</b> parameter, we can choose exactly which beans must be instanciated, in order to initialize the Jawr component.</p>
<p>For Spring MVC, Jawr provides the JawrSpringController which generates the bundles and handles the request. By default, if you don&#x2019;t provide the spring configuration files to the bundle processor, it will search for the configuration file associated to your spring dispatcher servlet. For example:</p>

<div class="source">
<pre>        &lt;servlet&gt;
              &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
              &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
              &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
        &lt;/servlet&gt;
</pre></div>
<p>With the below configuration, the bundle processor will search for a configuration file named <b>dispatcher</b>-servlet.xml. Here <b>dispatcher</b> is the name of the servlet.</p>
<p>If in your spring MVC configuration file, you don&#x2019;t have only the JawrSpringController defined (which is generally the case), we advise you to create a separate file containing only the JawrSpringController declaration, and use the import tag to include it in your spring configuration. In that case, you must pass the spring configuration file containing the JawrSpringController declaration as an argument to the bundle processor.</p>
<p>If your controller uses dynamic properties, you can define these dynamic properties in another file, and pass to the bundle processor the files defining the properties and the JawrSpringController.</p>
<p>For example, if you have the following JawrSpringController declaration :</p>

<div class="source">
<pre>        &lt;!-- Base Jawr config --&gt;
        &lt;bean id=&quot;jawrJsController&quot;  class=&quot;net.jawr.web.servlet.JawrSpringController&quot; &gt;
                &lt;!-- This must match the servlet-mapping to which the spring servlet is bound --&gt;
                &lt;property name=&quot;mapping&quot; value=&quot;/spring/&quot;/&gt;

                &lt;!-- This must match the controller mapping prefix to which the 
                        jawr controllers are bound at the urlMapping bean below --&gt;
                &lt;property name=&quot;controllerMapping&quot; value=&quot;/jawrJS/&quot;/&gt;
                &lt;property name=&quot;configuration&quot;&gt;
                        &lt;props&gt;
                                &lt;prop key=&quot;jawr.gzip.on&quot;&gt;{gzip.resource}&lt;/prop&gt;
                        &lt;/props&gt;
                &lt;/property&gt;
                &lt;property name=&quot;configLocation&quot; value=&quot;/jawr-springMVC.properties&quot; /&gt;
        &lt;/bean&gt;
</pre></div>
<p>In the configuration above, you will notice that the &#x201c;jawr.gzip.on&#x201d; property is set with the value of &#x201c;<a href="">gzip.resource</a>&#x201d;. If you have a such configuration, you will probably have the declaration of your property in another file. And in that case you will pass the file defining the <b>gzip.resource</b> property to the bundle processor, so the Jawr component initialization can be initialized properly.</p></div>
<div class="section">
<h3>CDN support<a name="CDN_support"></a></h3>
<p>One of the goals of this feature is to provide a better support for CDN. In the CDN directory, generated by the BundleProcessor, you will find all the bundles which are accessible in production and in debug modes.</p>
<p>To define the URL which will contain the Jawr bundles on the CDN, you must specify the context path, which should be used like below:</p>

<div class="source">
<pre>        jawr.url.contextpath.override=http://myCDN.com/myApplication
        jawr.url.contextpath.ssl.override=https://myCDN.com/myApplication
</pre></div>
<p>It is also possible to use the resources files from the CDN even in debug mode using:</p>

<div class="source">
<pre>        jawr.url.contextpath.override.used.in.debug.mode=true
</pre></div>
<div class="section">
<h4>Apache support<a name="Apache_support"></a></h4>
<p>The bundle processor also generates a configuration file, containing the rewrite settings for the httpd.conf file of apache. This file named <b>jawr-apache-httpd.conf</b> is generated in the <b>CDN</b> folder.</p></div></div>
<div class="section">
<h3>Limitations<a name="Limitations"></a></h3>
<p>As explained above, the bundle preprocessing uses the predefined mapping described in the full mapping files. This means that in debug mode, if you update a resource file, which is already part of a bundle, the change will be taken in account.</p>
<p><b>BUT</b> if you add a new resource file to a bundle mapping, this resource file will never be taken into account, unless you clean your working directory and start your application again.</p>
<p>Note also that, you could switch from debug mode to production mode, without launching the bundling process, but you have to keep in mind that the production bundles are the ones which have been processed during the bundling phase. This means that if you have modified a resource file, since the latest bundling process, you will have to launch the bundling process again to have this updated resource file in your production bundle.</p></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                   2017.
          All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
